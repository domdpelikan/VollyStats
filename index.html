<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-button.active {
            border-color: #4f46e5;
            background-color: #eef2ff;
            color: #4338ca;
        }
        .rating-button.active {
            background-color: #4f46e5;
            color: white;
            transform: scale(1.1);
        }
        #team-code-display {
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Main App Container -->
    <div id="app" class="max-w-xl mx-auto p-4 min-h-screen">
        
        <!-- Team Selection Section (Visible on start) -->
        <div id="team-selection-section" class="flex flex-col items-center justify-center min-h-screen">
            <div class="w-full max-w-sm text-center">
                <h1 class="text-3xl font-bold text-indigo-600 mb-2">Stats</h1>
                <p class="text-gray-500 mb-8">Pulse 16's</p>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4">Join a Team Roster</h2>
                    <input type="text" id="team-code-input" placeholder="Enter 6-digit team code" maxlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-md text-center uppercase tracking-widest focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button id="join-team-btn" class="w-full mt-3 bg-indigo-600 text-white font-semibold py-3 rounded-md hover:bg-indigo-700 transition">Join Roster</button>
                    <div class="relative flex py-5 items-center">
                        <div class="flex-grow border-t border-gray-200"></div>
                        <span class="flex-shrink mx-4 text-gray-400 text-sm">OR</span>
                        <div class="flex-grow border-t border-gray-200"></div>
                    </div>
                    <button id="create-team-btn" class="w-full bg-green-600 text-white font-semibold py-3 rounded-md hover:bg-green-700 transition">Create a New Team</button>
                    <p id="team-error" class="text-red-500 text-sm h-5 mt-3"></p>
                </div>
            </div>
        </div>

        <!-- Main App Content (Initially hidden) -->
        <div id="main-app-section" class="hidden">
            <header class="text-center my-6">
                <h1 class="text-3xl font-bold text-indigo-600">Stats</h1>
                <p class="text-gray-500 mt-1">Pulse 16's</p>
                 <div class="mt-4">
                    <span class="text-sm text-gray-500">Team Code:</span>
                    <span id="team-code-display" class="font-mono bg-indigo-100 text-indigo-700 text-lg font-bold p-2 rounded-md tracking-widest" title="Click to copy"></span>
                     <button id="switch-team-btn" class="ml-2 text-sm text-indigo-600 hover:underline">Switch</button>
                </div>
            </header>

            <!-- Tab Navigation -->
            <div class="flex border-b border-gray-200 mb-6">
                <button id="roster-tab-btn" class="tab-button flex-1 py-3 px-4 text-center font-semibold text-gray-600 border-b-2 border-transparent transition duration-200 ease-in-out hover:bg-gray-100 active">Roster</button>
                <button id="stats-tab-btn" class="tab-button flex-1 py-3 px-4 text-center font-semibold text-gray-600 border-b-2 border-transparent transition duration-200 ease-in-out hover:bg-gray-100">Passing Stats</button>
            </div>

            <!-- Roster Management Section -->
            <div id="roster-section">
                 <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4">Add Player to Roster</h2>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <input type="text" id="player-name-input" placeholder="Enter player's name" class="flex-grow w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <select id="player-position-select" class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white">
                            <option value="Libero">Libero</option>
                            <option value="Outside">Outside</option>
                            <option value="Middle">Middle</option>
                            <option value="Opposite">Opposite</option>
                            <option value="Setter">Setter</option>
                        </select>
                        <button id="add-player-btn" class="w-full sm:w-auto bg-indigo-600 text-white font-semibold px-6 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200 ease-in-out">Add Player</button>
                    </div>
                </div>
                <div id="roster-list" class="mt-6 space-y-3">
                    <div id="roster-loading" class="text-center p-4 text-gray-500">Loading roster...</div>
                </div>
            </div>

            <!-- Passing Stats Section -->
            <div id="stats-section" class="hidden">
                 <div class="bg-white p-6 rounded-lg shadow-md sticky top-4 z-10">
                    <h2 class="text-xl font-semibold mb-2 text-center">Today's Practice</h2>
                    <p id="practice-date" class="text-center text-indigo-600 font-semibold mb-4"></p>
                     <div id="rating-buttons" class="grid grid-cols-4 gap-3">
                        <button data-rating="0" class="rating-button text-2xl font-bold py-4 rounded-lg bg-white shadow-sm hover:shadow-md transition duration-200">0</button>
                        <button data-rating="1" class="rating-button text-2xl font-bold py-4 rounded-lg bg-white shadow-sm hover:shadow-md transition duration-200">1</button>
                        <button data-rating="2" class="rating-button text-2xl font-bold py-4 rounded-lg bg-white shadow-sm hover:shadow-md transition duration-200">2</button>
                        <button data-rating="3" class="rating-button text-2xl font-bold py-4 rounded-lg bg-white shadow-sm hover:shadow-md transition duration-200">3</button>
                    </div>
                    <p id="rating-helper" class="text-center text-gray-500 mt-4 h-5">Select a rating to assign a pass.</p>
                </div>
                <div id="stats-list" class="mt-6">
                     <div id="stats-loading" class="text-center p-4 text-gray-500">Loading players...</div>
                </div>
                <div class="mt-8 text-center">
                    <button id="download-csv-btn" class="bg-green-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-200 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                        Download All Stats (CSV)
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Player Selection Modal -->
    <div id="player-select-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-sm w-full">
            <div class="p-4 border-b">
                <h2 id="modal-title" class="text-xl font-semibold text-center">Assign Rating to Player</h2>
            </div>
            <div id="modal-player-list" class="p-4 space-y-2 max-h-96 overflow-y-auto"></div>
            <div class="p-4 border-t bg-gray-50">
                <button id="modal-cancel-btn" class="w-full bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Cancel</button>
            </div>
        </div>
    </div>


    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, getDoc, updateDoc, setLogLevel, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration & Initialization ---
        const firebaseConfig = {
            apiKey: "AIzaSyD-vfd0a-D8cUbJwPJUDb--HC_AVZ8oXts",
            authDomain: "vollystats.firebaseapp.com",
            projectId: "vollystats",
            storageBucket: "vollystats.appspot.com",
            messagingSenderId: "28498807951",
            appId: "1:28498807951:web:ec043113c35515a753b4fa"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        setLogLevel('debug');

        // --- App State ---
        let selectedRating = null;
        let playersCache = [];
        let currentTeamId = null;
        let rosterCollectionRef = null;

        // --- Date Management ---
        const today = new Date();
        const todayKey = today.toISOString().split('T')[0];
        const practiceDateDisplay = today.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });

        // --- UI Element References ---
        const teamSelectionSection = document.getElementById('team-selection-section');
        const mainAppSection = document.getElementById('main-app-section');
        const teamCodeInput = document.getElementById('team-code-input');
        const joinTeamBtn = document.getElementById('join-team-btn');
        const createTeamBtn = document.getElementById('create-team-btn');
        const teamError = document.getElementById('team-error');
        const teamCodeDisplay = document.getElementById('team-code-display');
        const switchTeamBtn = document.getElementById('switch-team-btn');
        // Main app UI
        const rosterTabBtn = document.getElementById('roster-tab-btn');
        const statsTabBtn = document.getElementById('stats-tab-btn');
        const rosterSection = document.getElementById('roster-section');
        const statsSection = document.getElementById('stats-section');
        const playerNameInput = document.getElementById('player-name-input');
        const addPlayerBtn = document.getElementById('add-player-btn');
        const rosterList = document.getElementById('roster-list');
        const statsList = document.getElementById('stats-list');
        const ratingButtonsContainer = document.getElementById('rating-buttons');
        const ratingHelper = document.getElementById('rating-helper');
        const practiceDateEl = document.getElementById('practice-date');
        const downloadCsvBtn = document.getElementById('download-csv-btn');
        // Modal UI
        const playerSelectModal = document.getElementById('player-select-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalPlayerList = document.getElementById('modal-player-list');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        
        practiceDateEl.textContent = `(${practiceDateDisplay})`;

        // --- Team Management ---
        const loadTeam = (teamId) => {
            currentTeamId = teamId.toUpperCase();
            rosterCollectionRef = collection(db, "teams", currentTeamId, "roster");
            
            localStorage.setItem('vollystats_teamId', currentTeamId);
            teamCodeDisplay.textContent = currentTeamId;
            
            teamSelectionSection.classList.add('hidden');
            mainAppSection.classList.remove('hidden');

            listenForRosterChanges();
        };

        const handleJoinTeam = async () => {
            const teamId = teamCodeInput.value.trim().toUpperCase();
            if (teamId.length !== 6) {
                teamError.textContent = "Please enter a 6-character code.";
                return;
            }
            teamError.textContent = "";
            const teamDocRef = doc(db, "teams", teamId);
            try {
                const teamDocSnap = await getDoc(teamDocRef);
                if (teamDocSnap.exists()) {
                    loadTeam(teamId);
                } else {
                    teamError.textContent = "Team not found. Please check the code.";
                }
            } catch (error) {
                console.error("Error joining team:", error);
                teamError.textContent = "Could not verify team code.";
            }
        };

        const handleCreateTeam = async () => {
            const newTeamId = Math.random().toString(36).substring(2, 8).toUpperCase();
            const teamDocRef = doc(db, "teams", newTeamId);
            try {
                await setDoc(teamDocRef, { createdAt: new Date() });
                loadTeam(newTeamId);
            } catch (error) {
                console.error("Error creating team:", error);
                teamError.textContent = "Could not create a new team.";
            }
        };
        
        const handleSwitchTeam = () => {
            localStorage.removeItem('vollystats_teamId');
            currentTeamId = null;
            rosterCollectionRef = null;
            playersCache = [];
            teamCodeInput.value = '';
            mainAppSection.classList.add('hidden');
            teamSelectionSection.classList.remove('hidden');
        };

        // --- UI Rendering ---
        const renderRosterList = (players) => {
            document.getElementById('roster-loading')?.remove();
            if (players.length === 0) {
                rosterList.innerHTML = `<div class="bg-white p-4 rounded-lg shadow-sm text-center text-gray-500">Your roster is empty. Add a player to get started!</div>`;
                return;
            }
            rosterList.innerHTML = players.map(player => `
                <div class="bg-white p-4 rounded-lg shadow-sm flex justify-between items-center">
                     <div>
                        <span class="font-medium text-lg">${player.name}</span>
                        <span class="text-xs uppercase font-semibold text-indigo-600 bg-indigo-100 ml-2 px-2 py-1 rounded-full">${player.position || 'N/A'}</span>
                    </div>
                    <button data-id="${player.id}" class="delete-player-btn text-red-500 hover:text-red-700 font-semibold transition-colors">Remove</button>
                </div>
            `).join('');
        };
        const renderStatsList = (players) => {
            document.getElementById('stats-loading')?.remove();
            if (players.length === 0) {
                statsList.innerHTML = `<div class="bg-white p-4 rounded-lg shadow-sm text-center text-gray-500">Add players to the roster to start tracking stats.</div>`;
                downloadCsvBtn.disabled = true;
                return;
            }
            downloadCsvBtn.disabled = false;
            const groups = [ { title: 'Liberos', positions: ['Libero'] }, { title: 'Outsides', positions: ['Outside'] }, { title: 'Middles / Opposites / Setters', positions: ['Middle', 'Opposite', 'Setter'] }];
            const playerCardHtml = (player) => {
                const statsByDate = player.statsByDate || {};
                const todayPasses = statsByDate[todayKey] || [];
                const passCount = todayPasses.length;
                const passSum = todayPasses.reduce((sum, current) => sum + current, 0);
                const average = passCount > 0 ? (passSum / passCount).toFixed(2) : '0.00';
                const pastPracticeKeys = Object.keys(statsByDate).filter(key => key !== todayKey).sort().reverse();
                let historyHtml = '<p class="text-xs text-gray-400 italic">No past practices recorded.</p>';
                if (pastPracticeKeys.length > 0) {
                    historyHtml = pastPracticeKeys.map(dateKey => {
                        const passes = statsByDate[dateKey] || [];
                        const count = passes.length;
                        if (count === 0) return '';
                        const sum = passes.reduce((s, c) => s + c, 0);
                        const avg = (sum/count).toFixed(2);
                        const displayDate = new Date(dateKey + 'T00:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        return `<div class="text-sm text-gray-600">${displayDate}: <span class="font-semibold">Avg ${avg}</span> (${count} passes)</div>`;
                    }).join('');
                }
                return `
                <div class="bg-white p-4 rounded-lg shadow-sm space-y-3">
                    <div>
                        <h3 class="font-bold text-lg text-indigo-700">${player.name}</h3>
                        <p class="text-sm text-gray-500">Today's Avg: <span class="font-semibold text-xl text-gray-800">${average}</span></p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Today's Passes (${passCount} total):</p>
                        <p class="text-gray-700 break-words">${todayPasses.length > 0 ? todayPasses.join(', ') : 'No passes recorded for today.'}</p>
                    </div>
                    <div class="mt-2">
                        <p class="text-xs font-semibold text-gray-600 mb-1">Practice History</p>
                        <div class="space-y-1">${historyHtml}</div>
                    </div>
                </div>`;
            };
            let finalHtml = groups.map(group => {
                const playersInGroup = players.filter(p => p.position && group.positions.includes(p.position)).sort((a, b) => a.name.localeCompare(b.name));
                if (playersInGroup.length === 0) return '';
                return `
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-gray-700 pb-2 mb-3 border-b-2 border-indigo-200">${group.title}</h2>
                        <div class="space-y-3">${playersInGroup.map(playerCardHtml).join('')}</div>
                    </div>`;
            }).join('');
             const unassignedPlayers = players.filter(p => !p.position).sort((a,b)=>a.name.localeCompare(b.name));
             if (unassignedPlayers.length > 0) {
                 finalHtml += `
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold text-gray-700 pb-2 mb-3 border-b-2 border-gray-200">Unassigned</h2>
                        <div class="space-y-3">${unassignedPlayers.map(playerCardHtml).join('')}</div>
                    </div>`;
             }
            statsList.innerHTML = finalHtml || `<div class="bg-white p-4 rounded-lg shadow-sm text-center text-gray-500">No players found.</div>`;
        };
        const openPlayerSelectModal = () => {
            modalTitle.textContent = `Assign Rating: ${selectedRating}`;
            const groups = [ { title: 'Liberos', positions: ['Libero'] }, { title: 'Outsides', positions: ['Outside'] }, { title: 'Middles / Opposites / Setters', positions: ['Middle', 'Opposite', 'Setter'] }];
            const assignedPositions = groups.flatMap(g => g.positions);
            const playerButtonHtml = (player) => `<button data-id="${player.id}" class="player-select-btn w-full text-left p-3 rounded-lg bg-gray-100 hover:bg-indigo-100">${player.name}</button>`;
            
            let modalHtml = groups.map(group => {
                const playersInGroup = playersCache.filter(p => p.position && group.positions.includes(p.position)).sort((a, b) => a.name.localeCompare(b.name));
                if (playersInGroup.length === 0) return '';
                return `
                    <div class="mb-3">
                        <h3 class="text-sm font-semibold text-gray-500 mb-2 px-2">${group.title}</h3>
                        <div class="space-y-2">${playersInGroup.map(playerButtonHtml).join('')}</div>
                    </div>`;
            }).join('');
            const unassignedPlayers = playersCache.filter(p => !p.position || !assignedPositions.includes(p.position)).sort((a, b) => a.name.localeCompare(b.name));
            if (unassignedPlayers.length > 0) {
                modalHtml += `
                    <div class="mb-3">
                        <h3 class="text-sm font-semibold text-gray-500 mb-2 px-2">Unassigned</h3>
                        <div class="space-y-2">${unassignedPlayers.map(playerButtonHtml).join('')}</div>
                    </div>`;
            }
            modalPlayerList.innerHTML = modalHtml;
            if (modalPlayerList.innerHTML.trim() === '') {
                 modalPlayerList.innerHTML = `<p class="text-center text-gray-500">No players found in the roster.</p>`;
            }
            playerSelectModal.classList.remove('hidden');
        };
        const closePlayerSelectModal = () => {
            playerSelectModal.classList.add('hidden');
            modalPlayerList.innerHTML = '';
            document.querySelectorAll('.rating-button').forEach(btn => btn.classList.remove('active'));
            selectedRating = null;
        };

        // --- Firestore Logic ---
        const listenForRosterChanges = () => {
            if (!rosterCollectionRef) return;
            onSnapshot(rosterCollectionRef, (snapshot) => {
                playersCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderRosterList(playersCache.sort((a,b) => a.name.localeCompare(b.name)));
                renderStatsList(playersCache);
            }, (error) => {
                console.error("Error listening to roster changes: ", error);
                 let errorMessage = "Error fetching roster.";
                 if (error.code === 'permission-denied') {
                     errorMessage = "Database permissions error. Please update your Firestore security rules.";
                 }
                 rosterList.innerHTML = `<div class="text-center p-4 text-red-500">${errorMessage}</div>`;
                 statsList.innerHTML = `<div class="text-center p-4 text-red-500">${errorMessage}</div>`;
            });
        };
        const handleAddPlayer = async () => {
            const name = playerNameInput.value.trim();
            const position = document.getElementById('player-position-select').value;
            if (name && position && rosterCollectionRef) {
                try { await addDoc(rosterCollectionRef, { name: name, position: position, statsByDate: {} }); playerNameInput.value = ''; } 
                catch (error) { console.error("Error adding player: ", error); }
            }
        };
        const handleDeletePlayer = async (playerId) => {
            if (!currentTeamId) return;
            try { await deleteDoc(doc(db, "teams", currentTeamId, "roster", playerId)); } 
            catch (error) { console.error("Error deleting player: ", error); }
        };
        const handleAssignPass = async (playerId) => {
            if (selectedRating === null || !currentTeamId) return;
            try {
                const playerDocRef = doc(db, "teams", currentTeamId, "roster", playerId);
                const playerDocSnap = await getDoc(playerDocRef);
                if (playerDocSnap.exists()) {
                    const currentStats = playerDocSnap.data().statsByDate || {};
                    const todayPasses = currentStats[todayKey] || [];
                    const updatedTodayPasses = [...todayPasses, selectedRating];
                    const updatedStats = { ...currentStats, [todayKey]: updatedTodayPasses };
                    await updateDoc(playerDocRef, { statsByDate: updatedStats });
                    ratingHelper.textContent = `Assigned '${selectedRating}'! Select another rating.`;
                }
            } catch (error) { console.error("Error assigning pass: ", error); }
            finally { closePlayerSelectModal(); }
        };
        const handleDownloadCSV = () => {
            if (playersCache.length === 0) return;
            let csvContent = "Player Name,Position,Overall Passing Average\n";
            playersCache.forEach(player => {
                const statsByDate = player.statsByDate || {};
                const allPasses = Object.values(statsByDate).flat();
                const passCount = allPasses.length;
                const passSum = allPasses.reduce((sum, current) => sum + current, 0);
                const overallAverage = passCount > 0 ? (passSum / passCount).toFixed(2) : '0.00';
                csvContent += `"${player.name}","${player.position || 'N/A'}",${overallAverage}\n`;
            });
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8,' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            const exportDate = new Date().toISOString().split('T')[0];
            link.setAttribute("download", `volleyball_stats_${currentTeamId}_${exportDate}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // --- Event Listeners ---
        joinTeamBtn.addEventListener('click', handleJoinTeam);
        teamCodeInput.addEventListener('keyup', (e) => { if(e.key === 'Enter') handleJoinTeam(); });
        createTeamBtn.addEventListener('click', handleCreateTeam);
        switchTeamBtn.addEventListener('click', handleSwitchTeam);
        teamCodeDisplay.addEventListener('click', () => {
            navigator.clipboard.writeText(currentTeamId).then(() => {
                teamCodeDisplay.title = 'Copied!';
                setTimeout(() => { teamCodeDisplay.title = 'Click to copy'; }, 2000);
            });
        });
        rosterTabBtn.addEventListener('click', () => { rosterSection.classList.remove('hidden'); statsSection.classList.add('hidden'); rosterTabBtn.classList.add('active'); statsTabBtn.classList.remove('active'); });
        statsTabBtn.addEventListener('click', () => { rosterSection.classList.add('hidden'); statsSection.classList.remove('hidden'); rosterTabBtn.classList.remove('active'); statsTabBtn.classList.add('active'); });
        addPlayerBtn.addEventListener('click', handleAddPlayer);
        playerNameInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') handleAddPlayer(); });
        rosterList.addEventListener('click', (e) => { if (e.target.classList.contains('delete-player-btn')) { handleDeletePlayer(e.target.dataset.id); } });
        ratingButtonsContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.rating-button');
            if (button) { selectedRating = parseInt(button.dataset.rating, 10); document.querySelectorAll('.rating-button').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); openPlayerSelectModal(); }
        });
        modalPlayerList.addEventListener('click', (e) => { const button = e.target.closest('.player-select-btn'); if (button) { handleAssignPass(button.dataset.id); } });
        modalCancelBtn.addEventListener('click', closePlayerSelectModal);
        downloadCsvBtn.addEventListener('click', handleDownloadCSV);

        // --- App Initialization ---
        async function initApp() {
             try {
                await signInAnonymously(auth);
                const savedTeamId = localStorage.getItem('vollystats_teamId');
                if (savedTeamId) {
                    loadTeam(savedTeamId);
                }
            } catch (error) {
                console.error("Authentication failed:", error);
                teamError.textContent = "Could not connect to authentication service.";
            }
        }
        initApp();
    </script>
</body>
</html>

